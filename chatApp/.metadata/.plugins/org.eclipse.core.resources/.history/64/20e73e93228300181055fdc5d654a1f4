package sendData;

public class sendFile {
	 public static void main(String[] args) {
	        try {
	            Scanner sn = new Scanner(System.in);
	            Socket s = new Socket("127.0.0.1",8896);
	            OutputStream out = s.getOutputStream();
	            while(true){
	                System.out.println("请输入文件路径");
	                String pathAndFileName = sn.nextLine();
	                File f = new File(pathAndFileName);
	                if(!f.exists()){
	                    System.out.println("文件不存在");
	                    continue;
	                }else{
	                    InputStream in = new FileInputStream(f);
	                    int length = (int) f.length();
	                    if(length>1024*1024*5){
	                        System.out.println("文件过大");
	                        continue;
	                    }else{

	                        String[] tempFileType = pathAndFileName.split("\\.");
	                        String fileType = tempFileType[tempFileType.length-1];
	                        byte[] typeData = fileType.getBytes();
	                        byte[] sendTypeData = new byte[5];
	                        if(typeData.length<5){
	                            System.arraycopy(typeData, 0, sendTypeData, 0, typeData.length);
	                        }

	                        byte[] tempData = new byte[length];
	                        in.read(tempData);
	                        in.close();

	                        byte[] lengthData = intToByteArray(length);
	                        byte[] sendData = new byte[tempData.length+lengthData.length+sendTypeData.length];

	                        System.arraycopy(lengthData, 0, sendData, 0, lengthData.length);
	                        System.arraycopy(tempData, 0, sendData, lengthData.length, tempData.length);
	                        System.arraycopy(sendTypeData, 0, sendData, lengthData.length+tempData.length, sendTypeData.length);

	                        out.write(sendData);
	                        out.flush();
	                    }
	                }
	            }
	        } catch (UnknownHostException e) {
	            // TODO Auto-generated catch block
	            e.printStackTrace();
	        } catch (IOException e) {
	            // TODO Auto-generated catch block
	            e.printStackTrace();
	        }
	    }

	    private static int byteArrayToInt(byte[] b) {
	        return b[3] & 0xFF |
	                (b[2] & 0xFF) << 8 |
	                (b[1] & 0xFF) << 16 |
	                (b[0] & 0xFF) << 24;
	    }

	    private static byte[] intToByteArray(int a) {
	        return new byte[]{
	                (byte) ((a >> 24) & 0xFF),
	                (byte) ((a >> 16) & 0xFF),
	                (byte) ((a >> 8) & 0xFF),
	                (byte) (a & 0xFF)
	        };
	    }
}
